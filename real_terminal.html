<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>🥊 AI 배틀 - 실제 터미널</title>
    <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
    <style>
        body {
            margin: 0;
            padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1e1e1e;
            color: #ffffff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 12px;
            border-radius: 8px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 20px;
        }
        
        .header p {
            margin: 5px 0 0 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .terminals {
            display: flex;
            flex: 1;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .claude-container {
            border-color: #007ACC;
        }
        
        .claude-container.focused {
            border-color: #0099FF;
            box-shadow: 0 0 10px rgba(0, 153, 255, 0.3);
        }
        
        .gemini-container {
            border-color: #FF6B35;
        }
        
        .gemini-container.focused {
            border-color: #FF8855;
            box-shadow: 0 0 10px rgba(255, 136, 85, 0.3);
        }
        
        .status-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 3px;
            background: rgba(0,0,0,0.7);
            color: white;
            z-index: 10;
        }
        
        .status-thinking {
            background: #FF9800;
            animation: pulse 1.5s infinite;
        }
        
        .status-ready {
            background: #4CAF50;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .terminal-header {
            padding: 8px 12px;
            font-weight: bold;
            color: white;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .claude-header {
            background: #007ACC;
        }
        
        .gemini-header {
            background: #FF6B35;
        }
        
        .terminal {
            flex: 1;
            background: #1e1e1e;
        }
        
        .input-section {
            background: #252526;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        
        .input-label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #cccccc;
            font-size: 14px;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        textarea {
            flex: 1;
            padding: 8px 12px;
            font-size: 14px;
            background: #3c3c3c;
            color: white;
            border: 1px solid #5a5a5a;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            resize: vertical;
            min-height: 60px;
            max-height: 200px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #007ACC;
        }
        
        .chat-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .chat-controls button {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        button {
            padding: 8px 16px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        button:hover {
            background: #1177bb;
        }
        
        button.secondary {
            background: #5a5a5a;
        }
        
        button.secondary:hover {
            background: #6a6a6a;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🥊 AI 배틀 - VS Code 스타일 터미널</h1>
        <p>실제 Claude와 Gemini 터미널이 GUI 안에서 실행됩니다</p>
    </div>
    
    <div class="terminals">
        <div class="terminal-container claude-container" id="claude-container">
            <div class="status-indicator status-ready" id="claude-status">준비</div>
            <div class="terminal-header claude-header">
                <span>🤖</span>
                <span>Claude Code Terminal</span>
            </div>
            <div id="claude-terminal" class="terminal"></div>
        </div>
        
        <div class="terminal-container gemini-container" id="gemini-container">
            <div class="status-indicator status-ready" id="gemini-status">준비</div>
            <div class="terminal-header gemini-header">
                <span>🚀</span>
                <span>Gemini CLI Terminal</span>
            </div>
            <div id="gemini-terminal" class="terminal"></div>
        </div>
    </div>
    
    <div class="input-section">
        <div class="input-label">💬 두 터미널에 동시 명령어 전송</div>
        <div class="chat-controls">
            <button class="secondary" onclick="pasteFromClipboard()">📋 붙여넣기</button>
            <button class="secondary" onclick="clearInput()">🗑️ 입력 지우기</button>
            <button class="secondary" onclick="clearBoth()">🆑 터미널 지우기</button>
        </div>
        <div class="input-row">
            <textarea id="commandInput" placeholder="명령어나 메시지를 입력하세요... (Ctrl+Enter로 전송)"></textarea>
            <button onclick="sendToBoth()">📤 전송</button>
        </div>
    </div>

    <script src="node_modules/xterm/lib/xterm.js"></script>
    <script src="node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script>
        const { ipcRenderer } = require('electron');
        
        // VS Code와 같은 테마
        const terminalTheme = {
            background: '#1e1e1e',
            foreground: '#cccccc',
            cursor: '#ffffff',
            selection: '#264f78',
            black: '#000000',
            brightBlack: '#666666',
            red: '#cd3131',
            brightRed: '#f14c4c',
            green: '#0dbc79',
            brightGreen: '#23d18b',
            yellow: '#e5e510',
            brightYellow: '#f5f543',
            blue: '#2472c8',
            brightBlue: '#3b8eea',
            magenta: '#bc3fbc',
            brightMagenta: '#d670d6',
            cyan: '#11a8cd',
            brightCyan: '#29b8db',
            white: '#e5e5e5',
            brightWhite: '#ffffff'
        };
        
        // 터미널 생성 (VS Code 스타일)
        const claudeTerminal = new Terminal({
            theme: terminalTheme,
            fontFamily: '"Monaco", "Menlo", "Ubuntu Mono", monospace',
            fontSize: 13,
            lineHeight: 1.2,
            cursorBlink: true,
            scrollback: 1000
        });
        
        const geminiTerminal = new Terminal({
            theme: terminalTheme,
            fontFamily: '"Monaco", "Menlo", "Ubuntu Mono", monospace',
            fontSize: 13,
            lineHeight: 1.2,
            cursorBlink: true,
            scrollback: 1000
        });
        
        // Fit addon 추가 (창 크기에 맞춤)
        const claudeFitAddon = new FitAddon.FitAddon();
        const geminiFitAddon = new FitAddon.FitAddon();
        
        claudeTerminal.loadAddon(claudeFitAddon);
        geminiTerminal.loadAddon(geminiFitAddon);
        
        // 터미널을 DOM에 연결
        claudeTerminal.open(document.getElementById('claude-terminal'));
        geminiTerminal.open(document.getElementById('gemini-terminal'));
        
        // 크기 맞추기
        setTimeout(() => {
            claudeFitAddon.fit();
            geminiFitAddon.fit();
        }, 100);
        
        // 백엔드에서 터미널 출력 받기
        ipcRenderer.on('claude-data', (event, data) => {
            claudeTerminal.write(data);
        });
        
        ipcRenderer.on('gemini-data', (event, data) => {
            geminiTerminal.write(data);
        });
        
        // 포커스 상태 관리
        let currentFocus = null;
        
        // 터미널에서 키보드 입력을 백엔드로 전송
        claudeTerminal.onData((data) => {
            setStatus('claude', 'thinking', '입력 중...');
            ipcRenderer.send('claude-input', data);
        });
        
        geminiTerminal.onData((data) => {
            setStatus('gemini', 'thinking', '입력 중...');
            ipcRenderer.send('gemini-input', data);
        });
        
        // 터미널 포커스 이벤트
        claudeTerminal.onFocus(() => {
            setTerminalFocus('claude');
        });
        
        geminiTerminal.onFocus(() => {
            setTerminalFocus('gemini');
        });
        
        // 터미널 크기 변경 시 백엔드에 알림
        claudeTerminal.onResize((size) => {
            ipcRenderer.send('claude-resize', size);
        });
        
        geminiTerminal.onResize((size) => {
            ipcRenderer.send('gemini-resize', size);
        });
        
        // 상태 표시 함수
        function setStatus(terminal, type, message) {
            const statusElement = document.getElementById(`${terminal}-status`);
            statusElement.textContent = message;
            statusElement.className = `status-indicator status-${type}`;
        }
        
        // 터미널 포커스 표시 함수
        function setTerminalFocus(terminal) {
            // 모든 포커스 제거
            document.getElementById('claude-container').classList.remove('focused');
            document.getElementById('gemini-container').classList.remove('focused');
            
            // 선택된 터미널에 포커스 추가
            if (terminal) {
                document.getElementById(`${terminal}-container`).classList.add('focused');
                currentFocus = terminal;
            }
        }
        
        // 클립보드에서 붙여넣기
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                const textarea = document.getElementById('commandInput');
                textarea.value += text;
                textarea.focus();
            } catch (err) {
                alert('클립보드 접근 권한이 필요합니다.');
            }
        }
        
        // 입력창 지우기
        function clearInput() {
            document.getElementById('commandInput').value = '';
            document.getElementById('commandInput').focus();
        }
        
        // 두 터미널에 동시 명령어 전송
        function sendToBoth() {
            const command = document.getElementById('commandInput').value.trim();
            if (!command) return;
            
            // 상태를 '전송 중'으로 변경
            setStatus('claude', 'thinking', '처리 중...');
            setStatus('gemini', 'thinking', '처리 중...');
            
            // 명령어 전송
            ipcRenderer.send('send-to-both', command);
            document.getElementById('commandInput').value = '';
            
            // 일정 시간 후 상태를 '준비'로 변경
            setTimeout(() => {
                setStatus('claude', 'ready', '준비');
                setStatus('gemini', 'ready', '준비');
            }, 3000);
        }
        
        // 두 터미널 지우기
        function clearBoth() {
            claudeTerminal.clear();
            geminiTerminal.clear();
            setStatus('claude', 'ready', '준비');
            setStatus('gemini', 'ready', '준비');
        }
        
        // 키보드 이벤트
        document.getElementById('commandInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendToBoth();
            } else if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                sendToBoth();
            }
        });
        
        // 터미널 컨테이너 클릭 시 포커스
        document.getElementById('claude-container').addEventListener('click', () => {
            claudeTerminal.focus();
            setTerminalFocus('claude');
        });
        
        document.getElementById('gemini-container').addEventListener('click', () => {
            geminiTerminal.focus();
            setTerminalFocus('gemini');
        });
        
        // 창 크기 변경 시 터미널 크기 조정
        window.addEventListener('resize', () => {
            setTimeout(() => {
                claudeFitAddon.fit();
                geminiFitAddon.fit();
            }, 100);
        });
    </script>
</body>
</html>