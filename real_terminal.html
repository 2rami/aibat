<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AI Battle Terminal</title>
    <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
    <link href="https://cdn.jsdelivr.net/gh/fonts-archive/Galmuri/Galmuri.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 8px;
            font-family: 'Galmuri', 'Monaco', 'Consolas', monospace;
            background: #000000;
            color: #00ff00;
            height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 12px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 8px;
            background: #000000;
            border: 1px solid #00ff00;
            padding: 8px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 14px;
            color: #00ff00;
        }
        
        .header p {
            margin: 4px 0 0 0;
            font-size: 10px;
            color: #00aa00;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            gap: 4px;
            margin-bottom: 4px;
        }
        
        .terminals {
            display: flex;
            flex: 2;
            gap: 4px;
        }
        
        .ai-summary-panel {
            flex: 1;
            border: 1px solid #333333;
            background: #000000;
            display: flex;
            flex-direction: column;
            max-width: 350px;
            min-width: 300px;
            border-color: #9932cc;
        }
        
        .ai-summary-header {
            padding: 4px 8px;
            background: #000000;
            border-bottom: 1px solid #9932cc;
            color: #9932cc;
            font-size: 10px;
        }
        
        .ai-summary-content {
            flex: 1;
            padding: 8px;
            overflow-y: auto;
            font-size: 10px;
            line-height: 1.4;
        }
        
        .summary-item {
            margin-bottom: 8px;
            padding: 6px;
            border: 1px solid #444;
            background: #111;
            border-radius: 4px;
        }
        
        .summary-time {
            color: #9932cc;
            font-size: 9px;
            margin-bottom: 2px;
        }
        
        .summary-text {
            color: #cccccc;
            white-space: pre-wrap;
        }
        
        .summary-loading {
            color: #ffff00;
            font-style: italic;
        }
        
        .meta-terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid #333333;
            background: #000000;
            border-color: #ff6600;
        }
        
        .meta-terminal-container.focused {
            border-color: #ffffff;
        }
        
        .meta-header {
            background: #000000;
            border-bottom: 1px solid #ff6600;
        }
        
        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid #333333;
            background: #000000;
        }
        
        .claude-container {
            border-color: #333333;
        }
        
        .claude-container.focused {
            border-color: #ffffff;
        }
        
        .gemini-container {
            border-color: #333333;
        }
        
        .gemini-container.focused {
            border-color: #ffffff;
        }
        
        .terminal-header {
            padding: 4px 8px;
            font-weight: normal;
            color: #00ff00;
            font-size: 10px;
            background: #000000;
            border-bottom: 1px solid #333333;
        }
        
        .claude-header {
            background: #000000;
        }
        
        .gemini-header {
            background: #000000;
        }
        
        .terminal {
            flex: 1;
            background: #000000;
        }
        
        .input-section {
            background: #000000;
            padding: 8px;
            border: 1px solid #333333;
        }
        
        .input-section.focused {
            border-color: #ffffff;
        }
        
        .input-label {
            margin-bottom: 4px;
            font-weight: normal;
            color: #00ff00;
            font-size: 10px;
        }
        
        .input-row {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        textarea {
            flex: 1;
            padding: 4px 8px;
            font-size: 12px;
            background: #000000;
            color: #00ff00;
            border: 1px solid #333333;
            font-family: 'Galmuri', 'Monaco', 'Consolas', monospace;
            resize: vertical;
            min-height: 40px;
            max-height: 120px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #ffffff;
        }
        
        button {
            padding: 4px 12px;
            background: #000000;
            color: #00ff00;
            border: 1px solid #333333;
            cursor: pointer;
            font-size: 10px;
            font-family: 'Galmuri', 'Monaco', 'Consolas', monospace;
        }
        
        button:hover {
            border-color: #00ff00;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AI BATTLE TERMINAL v1.0</h1>
        <p>[CTRL+SHIFT+T] Switch Terminal | [F12] Debug Console | Working in: ~/Desktop</p>
    </div>
    
    <div class="main-content">
        <div class="terminals">
            <div class="terminal-container claude-container" id="claude-container">
                <div class="terminal-header claude-header">
                    [CLAUDE] Terminal
                </div>
                <div id="claude-terminal" class="terminal"></div>
            </div>
            
            <div class="terminal-container gemini-container" id="gemini-container">
                <div class="terminal-header gemini-header">
                    [GEMINI] Terminal
                </div>
                <div id="gemini-terminal" class="terminal"></div>
            </div>
        </div>
        
        <div class="ai-summary-panel">
            <div class="ai-summary-header">
                ğŸ¤– [OLLAMA] AI Summary
            </div>
            <div class="ai-summary-content" id="summary-content">
                <div class="summary-loading">
                    Ollama AIê°€ ëŒ€í™”ë¥¼ ë¶„ì„í•  ì¤€ë¹„ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-section" id="input-section">
        <div class="input-label">[BROADCAST] Send to both terminals</div>
        <div class="input-row">
            <textarea id="commandInput" placeholder="Type command or message..."></textarea>
            <button onclick="sendToBoth()">SEND</button>
        </div>
    </div>

    <script src="node_modules/xterm/lib/xterm.js"></script>
    <script src="node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script>
        const { ipcRenderer } = require('electron');
        
        // VS Codeì™€ ê°™ì€ í…Œë§ˆ
        const terminalTheme = {
            background: '#1e1e1e',
            foreground: '#cccccc',
            cursor: '#ffffff',
            selection: '#264f78',
            black: '#000000',
            brightBlack: '#666666',
            red: '#cd3131',
            brightRed: '#f14c4c',
            green: '#0dbc79',
            brightGreen: '#23d18b',
            yellow: '#e5e510',
            brightYellow: '#f5f543',
            blue: '#2472c8',
            brightBlue: '#3b8eea',
            magenta: '#bc3fbc',
            brightMagenta: '#d670d6',
            cyan: '#11a8cd',
            brightCyan: '#29b8db',
            white: '#e5e5e5',
            brightWhite: '#ffffff'
        };
        
        // í„°ë¯¸ë„ ìƒì„± (CLI í”½ì…€ì•„íŠ¸ ìŠ¤íƒ€ì¼)
        const claudeTerminal = new Terminal({
            theme: terminalTheme,
            fontFamily: '"Galmuri", "Monaco", "Consolas", monospace',
            fontSize: 12,
            lineHeight: 1.0,
            cursorBlink: true,
            cursorStyle: 'block',
            cursorWidth: 1,
            scrollback: 1000
        });
        
        const geminiTerminal = new Terminal({
            theme: terminalTheme,
            fontFamily: '"Galmuri", "Monaco", "Consolas", monospace',
            fontSize: 12,
            lineHeight: 1.0,
            cursorBlink: true,
            cursorStyle: 'block',
            cursorWidth: 1,
            scrollback: 1000
        });
        
        // Fit addon ì¶”ê°€ (ì°½ í¬ê¸°ì— ë§ì¶¤)
        const claudeFitAddon = new FitAddon.FitAddon();
        const geminiFitAddon = new FitAddon.FitAddon();
        
        claudeTerminal.loadAddon(claudeFitAddon);
        geminiTerminal.loadAddon(geminiFitAddon);
        
        // í„°ë¯¸ë„ì„ DOMì— ì—°ê²°
        claudeTerminal.open(document.getElementById('claude-terminal'));
        geminiTerminal.open(document.getElementById('gemini-terminal'));
        
        // í¬ê¸° ë§ì¶”ê¸° (ì—ëŸ¬ ë°©ì§€)
        function fitTerminals() {
            try {
                // í„°ë¯¸ë„ ì»¨í…Œì´ë„ˆê°€ ë³´ì´ëŠ”ì§€ í™•ì¸
                const claudeContainer = document.getElementById('claude-terminal');
                const geminiContainer = document.getElementById('gemini-terminal');
                
                if (claudeContainer && claudeContainer.offsetWidth > 0 && claudeFitAddon && claudeTerminal.element) {
                    claudeFitAddon.fit();
                    console.log('Claude í„°ë¯¸ë„ í¬ê¸° ì¡°ì •ë¨');
                }
                if (geminiContainer && geminiContainer.offsetWidth > 0 && geminiFitAddon && geminiTerminal.element) {
                    geminiFitAddon.fit();
                    console.log('Gemini í„°ë¯¸ë„ í¬ê¸° ì¡°ì •ë¨');
                }
            } catch (error) {
                console.log('í„°ë¯¸ë„ í¬ê¸° ì¡°ì • ì˜¤ë¥˜ (ë¬´ì‹œë¨):', error.message);
            }
        }
        
        // ì´ˆê¸° í¬ê¸° ì¡°ì •
        setTimeout(fitTerminals, 200);
        setTimeout(fitTerminals, 500);  // ë‘ ë²ˆ ì‹¤í–‰ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´
        
        // í„°ë¯¸ë„ ì˜ì—­ ì§ì ‘ í´ë¦­ ì´ë²¤íŠ¸ (ì´ˆê³ ì† ë°˜ì‘)
        document.getElementById('claude-terminal').addEventListener('mousedown', (e) => {
            e.stopPropagation();
            setTerminalFocus('claude');
        });
        
        document.getElementById('gemini-terminal').addEventListener('mousedown', (e) => {
            e.stopPropagation();
            setTerminalFocus('gemini');
        });
        
        // ì´ˆê¸°ì— ì…ë ¥ì°½(ì±„íŒ…ì°½)ì— í¬ì»¤ìŠ¤
        setTimeout(() => {
            setFocus('input');
        }, 200);
        
        // ì¡°ê¸ˆ ë” ëŠ¦ê²Œ í•œë²ˆ ë” ì„¤ì • (í™•ì‹¤í•˜ê²Œ)
        setTimeout(() => {
            setFocus('input');
        }, 800);
        
        // Ollama AI ìš”ì•½ ì‹œìŠ¤í…œ
        const ollamaAnalysis = {
            claudeHistory: [],
            geminiHistory: [],
            summaryCount: 0,
            isProcessing: false
        };
        
        // Ollama API í˜¸ì¶œ í•¨ìˆ˜
        async function callOllamaAPI(prompt) {
            try {
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'llama3.2:3b',
                        prompt: prompt,
                        stream: false
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Ollama API ì˜¤ë¥˜:', error);
                return 'âš ï¸ Ollama ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        }
        
        // AI ìš”ì•½ ìƒì„± í•¨ìˆ˜
        async function generateAISummary() {
            if (ollamaAnalysis.isProcessing) return;
            
            const claudeText = ollamaAnalysis.claudeHistory.slice(-2).join('\n').substring(0, 800);
            const geminiText = ollamaAnalysis.geminiHistory.slice(-2).join('\n').substring(0, 800);
            
            if (!claudeText && !geminiText) return;
            
            ollamaAnalysis.isProcessing = true;
            ollamaAnalysis.summaryCount++;
            
            // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
            const summaryDiv = document.getElementById('summary-content');
            const loadingItem = document.createElement('div');
            loadingItem.className = 'summary-item';
            loadingItem.innerHTML = `
                <div class="summary-time">${new Date().toLocaleTimeString('ko-KR', { hour12: false })}</div>
                <div class="summary-loading">ğŸ¤– AIê°€ ëŒ€í™”ë¥¼ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...</div>
            `;
            summaryDiv.insertBefore(loadingItem, summaryDiv.firstChild);
            
            // Ollamaì—ê²Œ ë³´ë‚¼ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
            let prompt = `ë‹¤ìŒì€ Claudeì™€ Gemini AI ê°„ì˜ ëŒ€í™”ì…ë‹ˆë‹¤. ì´ ëŒ€í™”ë¥¼ ê°„ê²°í•˜ê²Œ ìš”ì•½í•´ì£¼ì„¸ìš” (í•œêµ­ì–´ë¡œ, 100ì ì´ë‚´):\n\n`;
            
            if (claudeText) {
                prompt += `Claude: ${claudeText}\n\n`;
            }
            if (geminiText) {
                prompt += `Gemini: ${geminiText}\n\n`;
            }
            
            prompt += `ìš”ì•½:`;
            
            try {
                // Ollama API í˜¸ì¶œ
                const summary = await callOllamaAPI(prompt);
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                loadingItem.remove();
                
                // ìš”ì•½ ê²°ê³¼ í‘œì‹œ
                const summaryItem = document.createElement('div');
                summaryItem.className = 'summary-item';
                summaryItem.innerHTML = `
                    <div class="summary-time">ìš”ì•½ #${ollamaAnalysis.summaryCount} - ${new Date().toLocaleTimeString('ko-KR', { hour12: false })}</div>
                    <div class="summary-text">${summary}</div>
                `;
                summaryDiv.insertBefore(summaryItem, summaryDiv.firstChild);
                
                // ì˜¤ë˜ëœ ìš”ì•½ ì œê±° (ìµœëŒ€ 5ê°œë§Œ ìœ ì§€)
                const items = summaryDiv.querySelectorAll('.summary-item');
                if (items.length > 5) {
                    for (let i = 5; i < items.length; i++) {
                        items[i].remove();
                    }
                }
                
            } catch (error) {
                loadingItem.innerHTML = `
                    <div class="summary-time">${new Date().toLocaleTimeString('ko-KR', { hour12: false })}</div>
                    <div style="color: #ff4444;">âŒ ìš”ì•½ ìƒì„± ì‹¤íŒ¨: ${error.message}</div>
                `;
            }
            
            ollamaAnalysis.isProcessing = false;
        }
        
        // í…ìŠ¤íŠ¸ ì €ì¥ ë° ìš”ì•½ íŠ¸ë¦¬ê±°
        function saveAndSummarize(data, source) {
            const text = data.toString().trim();
            if (text.length < 10) return; // ë„ˆë¬´ ì§§ì€ í…ìŠ¤íŠ¸ ë¬´ì‹œ
            
            if (source === 'claude') {
                ollamaAnalysis.claudeHistory.push(text);
                if (ollamaAnalysis.claudeHistory.length > 5) {
                    ollamaAnalysis.claudeHistory.shift();
                }
            } else if (source === 'gemini') {
                ollamaAnalysis.geminiHistory.push(text);
                if (ollamaAnalysis.geminiHistory.length > 5) {
                    ollamaAnalysis.geminiHistory.shift();
                }
            }
            
            // 10ì´ˆë§ˆë‹¤ ìš”ì•½ ì‹¤í–‰
            clearTimeout(window.summaryTimer);
            window.summaryTimer = setTimeout(generateAISummary, 10000);
        }
        
        // ë°±ì—”ë“œì—ì„œ í„°ë¯¸ë„ ì¶œë ¥ ë°›ê¸° (AI ìš”ì•½ ì¶”ê°€)
        ipcRenderer.on('claude-data', (event, data) => {
            claudeTerminal.write(data);
            saveAndSummarize(data, 'claude');
        });
        
        ipcRenderer.on('gemini-data', (event, data) => {
            geminiTerminal.write(data);
            saveAndSummarize(data, 'gemini');
        });
        
        // í¬ì»¤ìŠ¤ ìƒíƒœ ê´€ë¦¬
        let currentFocus = null;
        
        // í„°ë¯¸ë„ì—ì„œ í‚¤ë³´ë“œ ì…ë ¥ì„ ë°±ì—”ë“œë¡œ ì „ì†¡
        claudeTerminal.onData((data) => {
            ipcRenderer.send('claude-input', data);
        });
        
        geminiTerminal.onData((data) => {
            ipcRenderer.send('gemini-input', data);
        });
        
        // í„°ë¯¸ë„ í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ (ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ ì œê±°)
        // claudeTerminal.onFocus(() => {
        //     setTerminalFocus('claude');
        // });
        // 
        // geminiTerminal.onFocus(() => {
        //     setTerminalFocus('gemini');
        // });
        
        // í„°ë¯¸ë„ í¬ê¸° ë³€ê²½ ì‹œ ë°±ì—”ë“œì— ì•Œë¦¼ (ì—ëŸ¬ ë°©ì§€)
        claudeTerminal.onResize((size) => {
            try {
                if (size && size.cols && size.rows) {
                    ipcRenderer.send('claude-resize', size);
                }
            } catch (error) {
                console.log('Claude ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        });
        
        geminiTerminal.onResize((size) => {
            try {
                if (size && size.cols && size.rows) {
                    ipcRenderer.send('gemini-resize', size);
                }
            } catch (error) {
                console.log('Gemini ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        });
        
        // ëŒ€ê¸° ì¤‘ì¸ ëª…ë ¹ì–´ ê´€ë¦¬
        let waitingForEnter = false;
        let lastCommand = '';
        
        // 3ê°œ ì˜ì—­ í¬ì»¤ìŠ¤ ê´€ë¦¬ (ì´ˆê³ ì† ë°˜ì‘)
        function setFocus(target) {
            // ëª¨ë“  í¬ì»¤ìŠ¤ ì œê±°
            document.getElementById('claude-container').classList.remove('focused');
            document.getElementById('gemini-container').classList.remove('focused');
            document.getElementById('input-section').classList.remove('focused');
            
            // ì„ íƒëœ ì˜ì—­ì— í¬ì»¤ìŠ¤ ì¶”ê°€
            if (target === 'claude') {
                document.getElementById('claude-container').classList.add('focused');
                geminiTerminal.blur();
                claudeTerminal.focus();
                currentFocus = 'claude';
            } else if (target === 'gemini') {
                document.getElementById('gemini-container').classList.add('focused');
                claudeTerminal.blur();
                geminiTerminal.focus();
                currentFocus = 'gemini';
            } else if (target === 'input') {
                document.getElementById('input-section').classList.add('focused');
                claudeTerminal.blur();
                geminiTerminal.blur();
                document.getElementById('commandInput').focus();
                currentFocus = 'input';
            }
        }
        
        // í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­
        function setTerminalFocus(terminal) {
            setFocus(terminal);
        }
        
        // ë¶ˆí•„ìš”í•œ í•¨ìˆ˜ë“¤ ì œê±°ë¨
        
        // ë‘ í„°ë¯¸ë„ì— ë™ì‹œ ëª…ë ¹ì–´ ì „ì†¡
        function sendToBoth() {
            const command = document.getElementById('commandInput').value.trim();
            if (!command) {
                // ëª…ë ¹ì–´ê°€ ë¹„ì–´ìˆê³  ëŒ€ê¸° ì¤‘ì´ë©´ ì—”í„°ë§Œ ì „ì†¡
                if (waitingForEnter) {
                    ipcRenderer.send('send-enter-both');
                    waitingForEnter = false;
                    document.getElementById('commandInput').placeholder = 'Type command or message...';
                    
                    // ì—”í„° ì „ì†¡ í›„ì—ë„ í„°ë¯¸ë„ í¬ì»¤ìŠ¤ ìœ ì§€
                    setTimeout(() => {
                        if (currentFocus === 'claude') {
                            claudeTerminal.focus();
                        } else if (currentFocus === 'gemini') {
                            geminiTerminal.focus();
                        }
                    }, 100);
                }
                return;
            }
            
            // ëª…ë ¹ì–´ ì „ì†¡
            ipcRenderer.send('send-to-both', command);
            lastCommand = command;
            waitingForEnter = true; // ë‹¤ìŒ ì—”í„°ë¥¼ ê¸°ë‹¤ë¦¼
            document.getElementById('commandInput').value = '';
            document.getElementById('commandInput').placeholder = 'Press Enter again to execute...';
            
            // ì „ì†¡ í›„ í˜„ì¬ ì„ íƒëœ í„°ë¯¸ë„ì— í¬ì»¤ìŠ¤ ìœ ì§€
            setTimeout(() => {
                if (currentFocus === 'claude') {
                    claudeTerminal.focus();
                } else if (currentFocus === 'gemini') {
                    geminiTerminal.focus();
                }
            }, 200);
        }
        
        // í„°ë¯¸ë„ ì§€ìš°ê¸° í•¨ìˆ˜ ì œê±°ë¨ (íˆìŠ¤í† ë¦¬ ì†ì‹¤ ë°©ì§€)
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.getElementById('commandInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendToBoth();
            } else if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                sendToBoth();
            }
        });
        
        // í„°ë¯¸ë„ ì»¨í…Œì´ë„ˆ í´ë¦­ ì‹œ í¬ì»¤ìŠ¤ (ì´ˆê³ ì† ë°˜ì‘)
        document.getElementById('claude-container').addEventListener('mousedown', (e) => {
            setTerminalFocus('claude');
        });
        
        document.getElementById('gemini-container').addEventListener('mousedown', (e) => {
            setTerminalFocus('gemini');
        });
        
        // ì…ë ¥ì°½ í´ë¦­ ì‹œ í¬ì»¤ìŠ¤
        document.getElementById('input-section').addEventListener('mousedown', (e) => {
            setFocus('input');
        });
        
        document.getElementById('commandInput').addEventListener('focus', () => {
            setFocus('input');
        });
        
        // Ctrl+Shift+Të¡œ í„°ë¯¸ë„ ì „í™˜ + F12ë¡œ ê°œë°œì ë„êµ¬ í† ê¸€
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+Të¡œ í„°ë¯¸ë„ ì „í™˜
            if (e.key === 'T' && e.ctrlKey && e.shiftKey) {
                e.preventDefault();
                console.log('Ctrl+Shift+T í„°ë¯¸ë„ ì „í™˜ ì‹¤í–‰');
                if (currentFocus === 'claude') {
                    setTerminalFocus('gemini');
                } else {
                    setTerminalFocus('claude');
                }
            }
            
            // F12ë¡œ ê°œë°œì ë„êµ¬ í† ê¸€
            if (e.key === 'F12') {
                e.preventDefault();
                ipcRenderer.send('toggle-devtools');
            }
        });
        
        // ì°½ í¬ê¸° ë³€ê²½ ì‹œ í„°ë¯¸ë„ í¬ê¸° ì¡°ì • (ê°œì„ ëœ ë²„ì „)
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                console.log('ì°½ í¬ê¸° ë³€ê²½ ê°ì§€ - í„°ë¯¸ë„ í¬ê¸° ì¡°ì •');
                fitTerminals();
                // ì¶”ê°€ë¡œ í•œ ë²ˆ ë” (ì•ˆì •ì„±)
                setTimeout(fitTerminals, 100);
            }, 100);
        });
        
        // ì¶”ê°€ ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ë“¤
        window.addEventListener('load', () => {
            setTimeout(fitTerminals, 200);
        });
        
        // í„°ë¯¸ë„ ì»¨í…Œì´ë„ˆ í¬ê¸° ë³€ê²½ ê°ì§€
        const resizeObserver = new ResizeObserver(() => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(fitTerminals, 50);
        });
        
        resizeObserver.observe(document.querySelector('.terminals'));
        
        // ì¶”ê°€ì ì¸ í¬ê¸° ì¡°ì • íŠ¸ë¦¬ê±°ë“¤
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(fitTerminals, 300);
            setTimeout(() => setFocus('input'), 500); // DOM ë¡œë“œ í›„ ì…ë ¥ì°½ í¬ì»¤ìŠ¤
        });
        
        // í„°ë¯¸ë„ì´ ë³´ì´ê²Œ ë  ë•Œë§ˆë‹¤ í¬ê¸° ì¡°ì •
        const observer = new MutationObserver(() => {
            setTimeout(fitTerminals, 100);
        });
        
        observer.observe(document.getElementById('claude-terminal'), {
            attributes: true,
            attributeFilter: ['style']
        });
        
        observer.observe(document.getElementById('gemini-terminal'), {
            attributes: true,
            attributeFilter: ['style']
        });
    </script>
</body>
</html>